## Архитектура проекта
Для выполнения задания было принято решение использовать фреймворк FastAPI в связи с высокой производительностью. 
Аннотация типов выполнена при помощи библиотеки Pydantic. В сервисе имеется только одна ручка: /predict для post-запроса, в теле которого может быть как один json указанного в тестовом наборе данных типа, так и массив таких json`ов. Предобученная модель вызывается в начале работы сервиса.
## Структура репозитория
1. Основная директория service содержит main.py, в котором описана логика сервиса. Файл global_constants содержит глобальные константы, а именно абсолютные пути для тестового набора данных test_data.csv и предобученной модели micromodel.cbm. В pick_regno написаны основные функции для предсказаний.
2. Директория data содержит набор с тестовыми данными test_data.csv и предобученную модель CatBoost micromodel.cbm.
3. Директория models содержит описания интерфейса данных, поступающих для обработки.
4. В папке test содержится unit-тест, в котором проверяется работа endpoint`a.
## Исправления
В ходе анализа pick_regno была обнаружена ошибка в функции count_foreign_syms -- отсутствовал возврат значения, что могло приводить к ошибкам. Также, для повышения производительности была изменена функция pick_regno: ранее на вход поступал путь к предобученной модели и модель вызывалась каждый раз при вызове функции. Теперь же на вход функции сразу поступает сама модель.
## Локальный запуск сервиса
Для локального запуска сервиса необходимо установить пакеты, указанные в requirements.txt: "pip install -r requirements.txt". Из корневой папки необходимо вызвать: "uvicorn service.main:app --reload".
## Unit-тест
Для запуска unit-теста в корневой папке необходимо выполнить команду: "python -m pytest tests/test.py -v"
## Deployment
Сервис развернут на бесплатном хостинге render.com. Этот хостинг предоставляет возможность бесплатно развернуть свое приложение в сети, однако если никаких запросов поступать не будет, то инстанс упадет. Поэтому была создана cron-job по отправке запросов, чтобы сервис не падал.
Отправить запрос можно по адресу https://de-test-task.onrender.com/predict. Пример HTTP запроса:
````
POST https://de-test-task.onrender.com/predict
Content-Type: application/json


{
  "regno_recognize": "А939НО196",
  "afts_regno_ai": "А939НО190",
  "recognition_accuracy": 6.4,
  "afts_regno_ai_score": 0.8689166903495789,
  "afts_regno_ai_char_scores": "[0.9998925924301147, 0.9999872446060181, 0.9999798536300659, 0.9999990463256836, 0.9988356232643127, 0.9998175501823425, 1.0, 0.999994158744812, 0.8702163696289062]",
  "afts_regno_ai_length_scores": "[3.2404470773350624e-10, 3.236617363011618e-10, 3.2367283853140805e-10, 3.2651523151905337e-10, 3.234087164738497e-10, 3.259402747701756e-10, 3.2362224011706076e-10, 4.545459564297971e-09, 2.996458192683349e-08, 1.0, 3.2479344214131345e-10]",
  "camera_type": "Стационарная",
  "camera_class": "Астра-Трафик",
  "time_check": "2021-08-01 09:02:59",
  "direction": "0"
}
